# Chapter 17. 플로우 연산자

- 플로우를 변형하고 다루기 위한 연산자
- 충간 연산자와 최종 연산자
- 커스텀 플로우 연산자 만들기

## 17.1 플로우 연산자로 플로우 조작

- 플로우도 다양한 중간 연산자와 최종 연산자가 있다.

## 17.2 중간 연산자는 업스트림 플로우에 적용되고 다운스트림 플로우를 반환한다

- 연산자가 적용되는 플로우: 업스트림 플로우
- 중간 연산자가 반환하는 플로우: 다운스트림 플로우
- 대부분의 연산자는 시퀀스, 컬렉션 연산자와 동일

### 17.2.1 업스트림 원소별로 임의의 값을 배출: transform 함수

- map과는 다르게 하나 이상의 원소를 배출하고 싶을 경우 사용

```kotlin
fun main() {
    val names = flow {
        emit("Jo")
        emit("May")
        emit("Sue")
    }

    val upperAndLowercasedNames = names.transform {
        emit(it.uppercase())
        emit(it.lowvercase())
    }
}
```

### 17.2.2 take나 관련 연산자는 플로우를 취소할 수 있다

- 연산자가 지정한 조건이 더 이상 유효하지 않을 때 업스트림 플로우 취소

```kotlin
fun main() {
    val names = flow {
        emit("Jo")
        emit("May")
        emit("Sue")
    }

    names.take(2) // 2번 배출 후 플로우 취소
        .collect {
            log(it)
        }

}
```

### 17.2.3 플로우의 각 단계 후킹: onStart, onEach, onCompletion, onEmpty

- onStart: 데이터 방출이 시작되기 직전에 한 번 호출되어 초기 설정 수행
- onEach: 플로우가 값을 내보낼 때마다 해당 값에 대해 특정 작업 수행
- onCompletion: 플로우의 수집이 성공적으로 완료되거나 예외로 종료될 때 호출되어 최종 정리 작업 수행
- onEmpty: 플로우가 아무런 데이터도 방출하지 않고 완료될 경우에만 호출되는 특별한 콜백

### 17.2.4 다운스트림 연산자와 수집자를 위한 원소 버퍼링: buffer 연산자

- buffer 연산자를 통해 다운스트림 플로우가 이미 배출된 원소를 처리하느라 바쁜 동안에도 업스트림 플로우가 원소를 배출할 수 있음

```kotlin
fun main() {
    val ids = getAllUserIds()
    runBlocking {
        ids.buffer(3)
            .map(getProfileFromNetwork(it))
            .collect { log("Got $it") }
    }
}
```

- buffer 연산자는 플로우의 생산자와 소비자 간의 속도 차이를 관리하여 플로우의 성능 최적화

### 17.2.5 중간값을 버리는 연산자: conflate 연산자

- 생산자(업스트림)는 계속해서 데이터 방출
- 소비자(다운스트림)는 느리게 처리될 경우
- conflate를 사용하면 소비자가 이전 값을 처리하는 동안 생산자가 새로운 값을 내보낼 때, 이전 값들은 버려지고 소비자가 준비될 때 가장 최신 값만 사용

### 17.2.6 일정 시간 동안 값을 필터링하는 연산자: debounce 연산자

- 즉각적으로 반응하지 않고 생산자가 특정 시간 간격 내에 새로운 값을 내보내지 않을 때만 가장 마지막으로 내보내진 값을 소비자에게 전달하도록 하는 연산자
- 검색 입력 필드, 버튼 중복 클릭 방지 등에서 사용

## 17.3 커스텀 중간 연산자 만들기

- 플로우 빌더 안에서 플로우를 수집하고 변환된 원소를 배출하는 방식으로 자신만의 중간 연산자를 만들 수 있다.